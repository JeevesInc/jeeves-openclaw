# OpenClaw Docker Setup Guide

> ðŸ”’ **Security:** This guide uses placeholder values (XXXX) for credentials. Never commit real tokens to Git.

## Prerequisites

- Docker Desktop with Compose v2+
- Google Gemini API key
- Slack workspace (admin access)

---

## Part 1: Get API Keys

### Gemini API Key

1. Visit https://makersuite.google.com/app/apikey
2. Click "Create API Key"
3. Select or create a Google Cloud project
4. Copy the API key â†’ Save as `GEMINI_API_KEY`

### Slack App Setup

#### Step 1: Create App
1. Go to https://api.slack.com/apps
2. Click "Create New App" â†’ "From scratch"
3. Name: `your-bot-name` (e.g., "openclaw")
4. Select your workspace â†’ "Create App"

#### Step 2: Enable Socket Mode
1. Navigate to: **Settings â†’ Socket Mode**
2. Toggle "Enable Socket Mode" to **ON**
3. Click "Generate Token and Scopes"
4. Token name: `openclaw-connection`
5. Add scope: `connections:write`
6. Click "Generate" â†’ **Copy the App Token** (starts with `xapp-`)
7. Save as `SLACK_APP_TOKEN`

> Socket Mode allows WebSocket connection (no public webhook URL needed)

#### Step 3: Configure Bot Scopes
1. Navigate to: **Features â†’ OAuth & Permissions**
2. Scroll to "Bot Token Scopes"
3. Add these scopes:
   - `app_mentions:read` - See @mentions
   - `channels:history` - Read public channel messages
   - `channels:read` - View public channels
   - `chat:write` - Send messages
   - `im:history` - Read direct messages
   - `im:read` - View DMs
   - `im:write` - Start DMs
   - `users:read` - View workspace users

#### Step 4: Install to Workspace
1. Still in **OAuth & Permissions**, scroll up
2. Click "Install to Workspace" (or "Reinstall" if updating scopes)
3. Review permissions â†’ Click "Allow"
4. **Copy the Bot User OAuth Token** (starts with `xoxb-`)
5. Save as `SLACK_BOT_TOKEN`

#### Step 5: Enable Event Subscriptions
1. Navigate to: **Features â†’ Event Subscriptions**
2. Toggle "Enable Events" to **ON**
3. Under "Subscribe to bot events", add:
   - `app_mention` - When bot is @mentioned
   - `message.channels` - Messages in channels
   - `message.im` - Direct messages
4. Click "Save Changes"

#### Step 6: Configure App Home (Optional but Recommended)
1. Navigate to: **Features â†’ App Home**
2. Under "Show Tabs", enable "Messages Tab"
3. Check "Allow users to send Slash commands and messages"
4. Set your bot's Display Name

---

## Part 2: Configure Files

### 1. Create Environment File

Copy template:
```bash
cp .env.example .env
```

Edit `.env` with your credentials:
```bash
# Gateway
OPENCLAW_CONFIG_DIR=~/.openclaw
OPENCLAW_WORKSPACE_DIR=~/.openclaw/workspace
OPENCLAW_GATEWAY_PORT=18789
OPENCLAW_BRIDGE_PORT=18790
OPENCLAW_GATEWAY_BIND=lan
OPENCLAW_GATEWAY_TOKEN=<auto-generated-or-set-your-own>
OPENCLAW_IMAGE=openclaw:local

# APIs
GEMINI_API_KEY=AIzaSyXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX

# Slack
SLACK_BOT_TOKEN=xoxb-XXXXXXXXXXXX-XXXXXXXXXXXX-XXXXXXXXXXXXXXXXXXXXXXXX
SLACK_APP_TOKEN=xapp-X-XXXXXXXXXXX-XXXXXXXXXXXX-XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
```

### 2. Create Configuration File

Save as `openclaw.json` in the repository root:

```json
{
  "gateway": {
    "mode": "local",
    "bind": "lan",
    "port": 18789
  },
  "agents": {
    "defaults": {
      "workspace": "~/.openclaw/workspace",
      "model": {
        "primary": "google/gemini-3-pro-preview"
      }
    },
    "list": [
      {
        "id": "main",
        "identity": {
          "name": "OpenClaw",
          "theme": "helpful AI assistant",
          "emoji": "ðŸ¦ž"
        }
      }
    ]
  },
  "channels": {
    "slack": {
      "enabled": true,
      "botToken": "${SLACK_BOT_TOKEN}",
      "appToken": "${SLACK_APP_TOKEN}",
      "dmPolicy": "pairing",
      "groupPolicy": "allowlist"
    }
  },
  "env": {
    "vars": {
      "GEMINI_API_KEY": "${GEMINI_API_KEY}",
      "SLACK_BOT_TOKEN": "${SLACK_BOT_TOKEN}",
      "SLACK_APP_TOKEN": "${SLACK_APP_TOKEN}"
    }
  }
}
```

---

## Part 3: Deploy

### 1. Build Docker Image
```bash
docker build -f ./Dockerfile -t openclaw:local .
```
Build time: ~2-3 minutes

### 2. Copy Configuration
```bash
mkdir -p ~/.openclaw
cp openclaw.json ~/.openclaw/openclaw.json
chmod 600 ~/.openclaw/openclaw.json
```

### 3. Start Gateway
```bash
docker compose up -d openclaw-gateway
```

### 4. Get Dashboard URL
```bash
docker compose run --rm openclaw-cli dashboard --no-open
```
Open the URL in your browser: `http://127.0.0.1:18789/#token=<your-token>`

### 5. Check Status
```bash
# View container status
docker compose ps

# View logs
docker compose logs -f openclaw-gateway

# Should see:
# - "gateway listening on ws://0.0.0.0:18789"
# - "slack socket mode connected"
```

---

## Part 4: Use with Slack

### First Message (Pairing)

1. **User messages the bot** in Slack (DM or mention in channel)
2. **Bot responds** with a pairing code (e.g., `V3RQ86NN`)
3. **Approve the pairing:**
   ```bash
   docker exec openclaw-openclaw-gateway-1 node dist/index.js pairing approve slack V3RQ86NN
   ```
4. **Start chatting!**

### List Pending Pairings
```bash
docker compose run --rm openclaw-cli pairing list
```

### Invite Bot to Channels
In Slack: `/invite @your-bot-name`

---

## Common Commands

### Container Management
```bash
# Start
docker compose up -d openclaw-gateway

# Stop
docker compose down

# Restart
docker compose restart openclaw-gateway

# Logs (real-time)
docker compose logs -f openclaw-gateway

# Logs (last 50 lines)
docker compose logs --tail=50 openclaw-gateway
```

### Rebuild & Redeploy
```bash
docker compose down
docker build -f ./Dockerfile -t openclaw:local .
docker compose up -d openclaw-gateway
```

### Pairing Management
```bash
# List pending requests
docker compose run --rm openclaw-cli pairing list

# Approve request
docker exec openclaw-openclaw-gateway-1 node dist/index.js pairing approve slack <CODE>

# Check Slack connection
docker compose logs openclaw-gateway | grep slack
```

---

## Troubleshooting

### Container Won't Start
```bash
# Check logs for errors
docker compose logs openclaw-gateway

# Common issues:
# - Invalid config: Run `docker exec <container> node dist/index.js doctor --fix`
# - Missing env vars: Check .env file
# - Port conflict: Change OPENCLAW_GATEWAY_PORT in .env
```

### Slack Not Connecting
```bash
# Verify tokens in .env
cat .env | grep SLACK

# Check Socket Mode status
docker compose logs openclaw-gateway | grep -i socket

# Ensure Socket Mode is enabled in Slack app settings
# Verify both tokens are correct (xoxb- and xapp-)
```

### Pairing Not Working
- Codes expire after 1 hour
- Maximum 3 pending requests per channel
- Request new code: message bot again
- Check pending requests: `docker compose run --rm openclaw-cli pairing list`

### Bot Shows Offline
- Check container: `docker compose ps`
- Restart gateway: `docker compose restart openclaw-gateway`
- Enable "Always Show My Bot as Online" in Slack App â†’ App Home

---

## Configuration Details

### Model
- **Provider:** Google Gemini
- **Model:** `google/gemini-3-pro-preview`
- **API Key:** Via `GEMINI_API_KEY` env var

### Ports
- **18789** - Gateway (WebSocket + HTTP)
- **18790** - Bridge

### Slack Settings
- **Connection:** Socket Mode (WebSocket)
- **DM Policy:** Pairing (first message requires approval)
- **Group Policy:** Allowlist (must be added to groups)

---

## Security Best Practices

### Files to Keep Private
- `.env` - Contains all tokens (already in `.gitignore`)
- `~/.openclaw/openclaw.json` - Config with references

### Token Safety
- Never commit tokens to Git
- Don't share in Slack/email
- Use `.env.example` for templates
- Rotate immediately if exposed

### If Tokens Are Exposed

**Slack:**
1. Go to app settings â†’ Regenerate tokens
2. Update `.env` with new tokens
3. Restart: `docker compose restart openclaw-gateway`

**Gemini:**
1. Go to Google AI Studio â†’ Delete exposed key
2. Create new API key
3. Update `.env`
4. Restart gateway

---

## File Structure

```
openclaw/
â”œâ”€â”€ .env                    # Your credentials (not in Git)
â”œâ”€â”€ .env.example            # Template (safe to commit)
â”œâ”€â”€ openclaw.json           # Config file
â”œâ”€â”€ docker-compose.yml      # Docker services
â”œâ”€â”€ Dockerfile              # Image definition
â””â”€â”€ SETUP.md               # This file
```

---

## Quick Reference

| Task | Command |
|------|---------|
| Build | `docker build -f ./Dockerfile -t openclaw:local .` |
| Start | `docker compose up -d openclaw-gateway` |
| Stop | `docker compose down` |
| Logs | `docker compose logs -f openclaw-gateway` |
| Dashboard | `docker compose run --rm openclaw-cli dashboard --no-open` |
| Pair User | `docker exec openclaw-openclaw-gateway-1 node dist/index.js pairing approve slack <CODE>` |
| List Pairings | `docker compose run --rm openclaw-cli pairing list` |
| Restart | `docker compose restart openclaw-gateway` |

---

## Support

- **Docs:** https://docs.openclaw.ai
- **GitHub:** https://github.com/openclaw/openclaw
- **Docker Guide:** https://docs.openclaw.ai/install/docker
- **Slack Integration:** https://docs.openclaw.ai/channels/slack

---

**Setup Complete!** ðŸ¦ž Your OpenClaw instance is running with Gemini + Slack.
